# BulC Homepage 테이블 정의서

## 테이블 목록

| No | 테이블명 | 설명 | 분류 |
|----|----------|------|------|
| 1 | users | 유저 테이블 | 일반 유저 |
| 2 | user_roles | 유저 등급 테이블 | 관리자 |
| 3 | products | 상품 종류 테이블 | 결제 |
| 4 | price_plans | 상품 가격 테이블 | 결제 |
| 5 | subscriptions | 유저 구독 관리 테이블 | 결제 |
| 6 | payments | 결제 테이블 (구독 정보) | 결제 |
| 7 | activity_logs | 로그 테이블 (로그인, 구매, 환불 등) | 일반 유저 |
| 8 | user_change_logs | 유저 정보 변경 로그 테이블 | 일반 유저 |
| 9 | admin_logs | 관리자 로그 테이블 | 관리자 |

---

## 1. users (유저 테이블)

사용자 기본 정보를 저장하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | email | VARCHAR(255) | NO | - | 이메일 (로그인 ID), UNIQUE |
| 3 | password_hash | VARCHAR(255) | YES | - | 비밀번호 해시 |
| 4 | name | VARCHAR(100) | YES | - | 이름 |
| 5 | phone_number | VARCHAR(50) | YES | - | 전화번호 |
| 6 | status | VARCHAR(20) | NO | 'active' | 계정 상태 (active/inactive/suspended) |
| 7 | role_id | BIGINT | YES | - | 유저 등급 FK → user_roles.id |
| 8 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |
| 9 | updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 수정일시 |

**상태값 (status)**
- `active`: 활성 계정
- `inactive`: 비활성 계정
- `suspended`: 정지된 계정

---

## 2. user_roles (유저 등급 테이블)

사용자 권한 등급을 정의하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | code | VARCHAR(50) | NO | - | 등급 코드, UNIQUE |
| 3 | name | VARCHAR(100) | NO | - | 등급명 |
| 4 | description | TEXT | YES | - | 설명 |
| 5 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |

**기본 등급 코드**
- `admin`: 관리자
- `user`: 일반 사용자
- `premium`: 프리미엄 사용자

---

## 3. products (상품 종류 테이블)

판매 상품을 정의하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | code | VARCHAR(50) | NO | - | 상품 코드, UNIQUE |
| 3 | name | VARCHAR(255) | NO | - | 상품명 |
| 4 | description | TEXT | YES | - | 상품 설명 |
| 5 | is_active | BOOLEAN | NO | TRUE | 활성화 여부 |
| 6 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |
| 7 | updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 수정일시 |

**상품 코드 예시**
- `BULC`: BulC 화재 시뮬레이션
- `VR_TRAINING`: VR 안전 교육

---

## 4. price_plans (상품 가격 테이블)

상품별 요금제를 정의하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | product_id | BIGINT | NO | - | 상품 FK → products.id |
| 3 | name | VARCHAR(100) | NO | - | 요금제명 (1개월, 3개월 등) |
| 4 | duration_months | INT | NO | - | 구독 기간 (개월) |
| 5 | price | DECIMAL(18,2) | NO | - | 가격 |
| 6 | currency | VARCHAR(10) | NO | 'KRW' | 통화 |
| 7 | is_active | BOOLEAN | NO | TRUE | 활성화 여부 |
| 8 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |
| 9 | updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 수정일시 |

---

## 5. subscriptions (유저 구독 관리 테이블)

사용자의 구독 현황을 관리하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | user_id | BIGINT | NO | - | 유저 FK → users.id |
| 3 | product_id | BIGINT | NO | - | 상품 FK → products.id |
| 4 | price_plan_id | BIGINT | NO | - | 요금제 FK → price_plans.id |
| 5 | status | VARCHAR(20) | NO | 'active' | 구독 상태 |
| 6 | start_date | TIMESTAMP | NO | - | 구독 시작일 |
| 7 | end_date | TIMESTAMP | NO | - | 구독 종료일 |
| 8 | auto_renew | BOOLEAN | NO | FALSE | 자동 갱신 여부 |
| 9 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |
| 10 | updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 수정일시 |

**구독 상태 (status)**
- `active`: 활성 구독
- `expired`: 만료됨
- `canceled`: 취소됨

---

## 6. payments (결제 테이블)

결제 및 환불 정보를 관리하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | user_id | BIGINT | NO | - | 유저 FK → users.id |
| 3 | user_email | VARCHAR(255) | NO | - | 결제 시점 이메일 |
| 4 | user_name | VARCHAR(100) | YES | - | 결제 시점 이름 |
| 5 | subscription_id | BIGINT | YES | - | 구독 FK → subscriptions.id |
| 6 | price_plan_id | BIGINT | NO | - | 요금제 FK → price_plans.id |
| 7 | amount | DECIMAL(18,2) | NO | - | 결제 금액 |
| 8 | currency | VARCHAR(10) | NO | 'KRW' | 통화 |
| 9 | status | VARCHAR(20) | NO | 'pending' | 결제 상태 |
| 10 | payment_method | VARCHAR(50) | YES | - | 결제 수단 (card/bank/kakao) |
| 11 | payment_provider | VARCHAR(50) | YES | - | PG사 (toss/inicis) |
| 12 | transaction_id | VARCHAR(255) | YES | - | PG 거래 ID |
| 13 | paid_at | TIMESTAMP | YES | - | 결제 완료 시각 |
| 14 | refunded_at | TIMESTAMP | YES | - | 환불 시각 |
| 15 | refund_amount | DECIMAL(18,2) | YES | - | 환불 금액 |
| 16 | refund_reason | TEXT | YES | - | 환불 사유 |
| 17 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |
| 18 | updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 수정일시 |

**결제 상태 (status)**
- `pending`: 결제 대기
- `completed`: 결제 완료
- `failed`: 결제 실패
- `refunded`: 환불 완료

---

## 7. activity_logs (로그 테이블)

로그인, 구매, 환불 등 사용자 활동을 기록하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | user_id | BIGINT | YES | - | 유저 FK → users.id |
| 3 | action | VARCHAR(50) | NO | - | 활동 유형 |
| 4 | target_type | VARCHAR(50) | YES | - | 대상 타입 |
| 5 | target_id | BIGINT | YES | - | 대상 ID |
| 6 | description | TEXT | YES | - | 상세 설명 |
| 7 | ip_address | VARCHAR(50) | YES | - | IP 주소 |
| 8 | user_agent | TEXT | YES | - | 브라우저 정보 |
| 9 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |

**활동 유형 (action)**
- `login`: 로그인
- `logout`: 로그아웃
- `purchase`: 구매
- `refund`: 환불
- `subscription_start`: 구독 시작
- `subscription_cancel`: 구독 취소

---

## 8. user_change_logs (유저 정보 변경 로그 테이블)

사용자 정보 변경 이력을 기록하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | user_id | BIGINT | NO | - | 유저 FK → users.id |
| 3 | changed_field | VARCHAR(100) | NO | - | 변경된 필드명 |
| 4 | old_value | TEXT | YES | - | 이전 값 |
| 5 | new_value | TEXT | YES | - | 새 값 |
| 6 | changed_by | BIGINT | YES | - | 변경한 사람 FK → users.id |
| 7 | change_reason | TEXT | YES | - | 변경 사유 |
| 8 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |

---

## 9. admin_logs (관리자 로그 테이블)

관리자 작업 이력을 기록하는 테이블

| No | 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|----|--------|-------------|------|--------|------|
| 1 | id | BIGINT | NO | AUTO | 기본키 |
| 2 | admin_id | BIGINT | NO | - | 관리자 FK → users.id |
| 3 | action | VARCHAR(100) | NO | - | 작업 유형 |
| 4 | target_type | VARCHAR(50) | NO | - | 대상 타입 |
| 5 | target_id | BIGINT | YES | - | 대상 ID |
| 6 | description | TEXT | YES | - | 작업 설명 |
| 7 | ip_address | VARCHAR(50) | YES | - | IP 주소 |
| 8 | created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 생성일시 |

---

## ERD 관계도

```
users ─────────┬──────────────────────────────────────┐
    │          │                                      │
    │ 1:N      │ 1:N                                  │ 1:N
    ▼          ▼                                      ▼
subscriptions  payments                         activity_logs
    │          │                                user_change_logs
    │          │                                admin_logs
    │          │
    │ N:1      │ N:1
    ▼          ▼
price_plans ◄──┘
    │
    │ N:1
    ▼
products

user_roles ◄── users (N:1)
```

---

## 결제 흐름 예시

1. **유저 회원가입**: `users` 테이블에 레코드 생성
2. **상품 선택**: `products` + `price_plans` 조회
3. **결제 진행**: `payments` 테이블에 pending 상태로 생성
4. **결제 완료**: `payments.status` → completed, `subscriptions` 레코드 생성
5. **구독 만료/갱신**: `subscriptions.status` 업데이트
6. **환불 요청**: `payments.status` → refunded, 환불 정보 기록
